@model GudSafe.Data.ViewModels.UserSettingsViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "User Settings";
}

<div>
    <div>
        <form id="resetApiKey">
            <div class="row">
                <label for="apikey">API-Key</label>
                <input class="form-control col" style="border-radius: 5px 0px 0px 5px" id="apikey" type="text" disabled="disabled" placeholder="APIKEY" value="@Model.ApiKey"/>
                <button class="btn btn-danger col-auto" type="button" onclick="resetApiKey()" style="border-radius: 0px 5px 5px 0px">Reset API Key</button>
            </div>
        </form>

        <div>
            <h1 class="display-6 mt-1">Change password</h1>

            @Html.ValidationSummary()

            @* @using (Html.BeginForm("ChangePassword", "Dashboard", new {returnUrl = Context.Request.Query["returnUrl"]}, FormMethod.Post)) *@
            <form id="changePassword">
                <div class="form-group row">
                    @Html.LabelFor(m => m.Password, "Password")
                    @Html.TextBoxFor(m => m.Password,
                        new {@class = "form-control", autocomplete = "current-password", id = "current-password", required = true, type = "password", placeholder = "Password"})
                </div>

                <div class="form-group row">
                    @Html.LabelFor(m => m.NewPassword, "New Password")
                    @Html.TextBoxFor(m => m.NewPassword,
                        new {@class = "form-control", autocomplete = "new-password", id = "new-password", required = true, type = "password", placeholder = "New password"})
                </div>

                <div class="form-group row">
                    @Html.LabelFor(m => m.ConfirmNewPassword, "Confirm New Password")
                    @Html.TextBoxFor(m => m.ConfirmNewPassword,
                        new {@class = "form-control", autocomplete = "new-password", id = "new-password", required = true, type = "password", placeholder = "Confirm new password"})
                </div>

                <div class="form-group row mt-3">
                    <button class="btn btn-gudsafe-primary" type="button" onclick="changePassword()">Change password</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function changePassword() {
            let data = $("#changePassword").serialize();
        
            $.ajax({
                url: "@Url.Action("ChangePassword")",
                type: "POST",
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                data: data,
                success: function (result) {
                    if (result.success) {
                        $("#changePassword").trigger("reset");
                    }
                },
            });
        }

        function resetApiKey() {
            $.ajax({
                url: "@Url.Action("ResetApiKey")",
                type: "POST",
                contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (result) {
                    if (result.success) {
                        $("#apikey").val(result.apiKey);
                    }
                },
            });
        }
    </script>
}